<html lang="en">
<head>
    <meta charset="" harset="utf-8">
    <title>Tracking</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.5/css/select.dataTables.min.css">

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script src="https://malsup.github.io/jquery.blockUI.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/1000hz-bootstrap-validator/0.11.9/validator.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.2.5/js/dataTables.select.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.5/moment-timezone-with-data.min.js"></script>
    
    <script>
    //
    // This is version 0.6.1 (test)
    //    

    var WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzy7vFDbJqYH9d5HLIST-FGrnhs6hIdfhT2Vm-l/exec";

    var TIMEZONE = "America/Los_Angeles";

    var _selectedRecord = null;
    var _currentTab = "awaitingScheduling";
    var _clients = [];
    var _experts = [];
    var _catalogs = [];

    var _statusesData = [];

    _statusesData["Awaiting Scheduling"] = {tab:"awaitingScheduling", 
        requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit"],
        requiredValues:[]};
    _statusesData["Awaiting Records"] = {tab:"awaitingRecords", 
        requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit"],
        requiredValues:[]};
    _statusesData["Awaiting Indexing"] = {tab:"awaitingIndexing", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit"],
        requiredValues:[]};
    _statusesData["Awaiting Shipment"] = {tab:"awaitingShipment", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit"],    
        requiredValues:[{field:"#recordStatus-edit", value:"Indexed"}]};
    _statusesData["Records Shipped"] = {tab:"recordShipped", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit"],
        requiredValues:[{field:"#recordStatus-edit", value:"Sent to expert"}]};
    _statusesData["Awaiting Report"] = {tab:"awaitingReport", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit"],
        requiredValues:[]};
    _statusesData["Report Done"] = {tab:"reportDone", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit", "#reportDone-edit"],
        requiredValues:[]};  //record done is controlled using a custom validation
    _statusesData["Awaiting Deposition"] = {tab:"awaitingDeposition", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit", "#reportDone-edit", "#futureService-edit"],
        requiredValues:[{field:"#reportDone-edit", value:"Yes"}, {field:"#futureService-edit", value:"Deposition"}, {field:"#recordStatus-edit", value:"Need to retrieve from expert"}]};
    _statusesData["Awaiting Arbitration"] = {tab:"awaitingArbitration", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit", "#reportDone-edit", "#futureService-edit"],
        requiredValues:[{field:"#reportDone-edit", value:"Yes"}, {field:"#futureService-edit", value:"Arbitration"}, {field:"#recordStatus-edit", value:"Need to retrieve from expert"}]};
	_statusesData["Awaiting Trial"] = {tab:"awaitingTrial", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit", "#reportDone-edit", "#futureService-edit"],
        requiredValues:[{field:"#reportDone-edit", value:"Yes"}, {field:"#futureService-edit", value:"Trial"}]}; //record status is controlled using a custom validation
    _statusesData["Closed"] = {tab:"closed", 
    	requiredFields:["#caseName-edit", "#client-edit", "#trialVenue-edit", "#serviceDate-edit", "#serviceType-edit", "#expert-edit", "#indexer-edit", "#hoursSpentIndexing-edit", "#recordStatus-edit", "#reportDone-edit", "#futureService-edit"],
        requiredValues:[{field:"#reportDone-edit", value:"Yes"}, {field:"#futureService-edit", value:"None"}]}; //record status is controlled using a custom validation

    $(function() {
        $("#tabs").tabs({
            activate: function(event, ui) {
                var tab = ui.newPanel.attr('id');
                _currentTab = tab;
                activate(tab);
            }
        });

        $.widget("custom.combobox", {
            _create: function() {
                this.wrapper = $( "<span>" )
                    .addClass( "custom-combobox" )
                    .insertBefore( this.element );
                this.element.hide();
                this._createAutocomplete();
            },
            _createAutocomplete: function() {
                var selected = this.element.children( ":selected" );
                var value = selected.val() ? selected.text() : "";
                this.input = $( "<input>" )
                    .appendTo( this.wrapper )
                    .val( value )
                    .attr( "title", "" )
                    .addClass( "custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left" )
                    .autocomplete({
                        delay: 0,
                        minLength: 0,
                        source: $.proxy(this, "_source")
                    }).tooltip({
                        classes: {
                            "ui-tooltip": "ui-state-highlight"
                        }
                    });

                this._on( this.input, {
                    autocompleteselect: function( event, ui ) {
                        ui.item.option.selected = true;
                        this._trigger( "select", event, {
                            item: ui.item.option
                        });
                    },
                    autocompletechange: "_removeIfInvalid"
                });
            },
            refresh: function() {
                var selected = this.element.children( ":selected" );
                var value = selected.val() ? selected.text() : "";
                this.input.val(value);
            },
            _source: function( request, response ) {
                var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
                response(this.element.children("option").map(function() {
                    var text = $(this).text();
                    if (this.value && (!request.term || matcher.test(text))) {
                        return { label: text, value: text, option: this };
                    }        
                }));
            },
 
            _removeIfInvalid: function( event, ui ) {
                
                this.input.attr( "title", "" );

                // Selected an item, nothing to do
                if ( ui.item ) {
                    return;
                }

                // Search for a match (case-insensitive)
                var value = this.input.val(),
                valueLowerCase = value.toLowerCase(),
                valid = false;
                this.element.children( "option" ).each(function() {
                    if ( $( this ).text().toLowerCase() === valueLowerCase ) {
                        this.selected = valid = true;
                        return false;
                    }
                });

                if (valid) {
                    return;
                }

                // Remove invalid value
                this.input.val( "" )
                    .attr( "title", value + " didn't match any item" )
                    .tooltip();
                this.element.val( "" );

                this.input.change();

                this.input.autocomplete( "instance" ).term = "";

            },
 
            _destroy: function() {
                this.wrapper.remove();
                this.element.show();
            }
        });

        loadList(_clients, "getClients");
        loadList(_experts, "getExperts");

        loadCatalog("ServiceTypesRange");
        loadCatalog("TranslatorStatusRange");
        loadCatalog("CaseStatusesRange");
        loadCatalog("SchedulingStatusesRange");
        loadCatalog("FutureServiceRange");
        loadCatalog("ReceptionStatusesRange");
        loadCatalog("RecordStatusesRange");
        loadCatalog("ReportDoneRange");
        loadCatalog("ReportFormatRange");
        loadCatalog("InvoiceSentRange");
        loadCatalog("PaymentReceivedRange");

        //records log popup
        loadCatalog("ReceivedFormatsRange");
        loadCatalog("LoggersRange");
        loadCatalog("RecordReceivedRange");
        loadCatalog("DoctorNotifiedRange");

        //contacts
        loadCatalog("ContactTypesRange");
        loadCatalog("PreferredFormatsRange");

        activate("awaitingScheduling");;

        setupNewRecordButton();
        setupDeleteRecordButton();

        setupEditRecordButton();
        setupEditFormValidationSupport();

        setupLogRecordsButtons();
        defineLogRecordsDialog();

        setupContactsButtons();
        defineContactsDialog();

        $("#editRecordBtn").attr("disabled", "disabled");
        $("#deleteRecordBtn").attr("disabled", "disabled");
        $("#logRecordsBtn").attr("disabled", "disabled");
        $("#schedulingBtn").attr("disabled", "disabled");
        $("#billingBtn").attr("disabled", "disabled");

    });

    function loadList(list, action) {
        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",            
            data: {
                action: action,
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                    return;
                }
                response.data.forEach(function(elem, i){
                    list.push({name:elem.contactName, contactId:elem.contactId}); 
                });
            }    
        });
    }

    function loadCatalog(catalog) {
        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",            
            data: {
                action: "getCatalog",
                catalog: catalog,
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                    return;
                }
                _catalogs[catalog] = [];
                response.data.forEach(function(elem, i){
                    _catalogs[catalog].push({name:elem.name});
                });
                //alert("_catalogs[catalog] "+JSON.stringify(_catalogs[catalog]))
            }    
        });        
    }

    function renderCellAsDate( data, type, row, meta ) {
        if ( type === 'display' || type === 'filter' ) {
            if (!data){
                return ""; 
            }    
            return moment(data).tz(TIMEZONE).format('MMMM Do YYYY');
        }
        return data;    
    }   

    function defineAwaitingSchedulingTab() {
        if ($.fn.DataTable.isDataTable("#awaitingSchedulingTable") ) {
            return;
        }
        var table = $('#awaitingSchedulingTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Scheduling",
                dataType: "jsonp",
            },
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "trialVenue" },
                { data: "trialDate" },
                { data: "schedulingStatus" },
                { data: "serviceType" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [{ 
                targets: 4,
                render:  renderCellAsDate,
            }],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table); 
    }

    function defineAwaitingRecordsTab() {
        if ($.fn.DataTable.isDataTable("#awaitingRecordsTable") ) {
            return;
        }
        var table = $('#awaitingRecordsTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Records",
                dataType: "jsonp",
            },
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },
                { data: "recordsDue" },
                { data: "contact"},
                { data: "recordsReceived"},
                { data: "recordStatus"},
                { data: "id",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 4, render:  renderCellAsDate }, 
                { targets: 5, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineAwaitingIndexingTab() {
        if ($.fn.DataTable.isDataTable("#awaitingIndexingTable") ) {
            return;
        }
        var table = $('#awaitingIndexingTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Indexing",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },
                { data: "recordsDue" },
                { data: "indexer" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 4, render:  renderCellAsDate }, 
                { targets: 5, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineAwaitingShipmentTab() {
        if ($.fn.DataTable.isDataTable("#awaitingShipmentTable") ) {
            return;
        }
        var table = $('#awaitingShipmentTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Shipment",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },
                { data: "recordsDue" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 4, render:  renderCellAsDate }, 
                { targets: 5, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineRecordShippedTab() {
        if ($.fn.DataTable.isDataTable("#recordShippedTable") ) {
            return;
        }
        var table = $('#recordShippedTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Records%20Shipped",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 4, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }        

    function defineAwaitingReportTab() {
        if ($.fn.DataTable.isDataTable("#awaitingReportTable") ) {
            return;
        }
        var table = $('#awaitingReportTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Report",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },          
                { data: "reportFormat" },                
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 4, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }        

    function defineReportDoneTab() {
        if ($.fn.DataTable.isDataTable("#reportDoneTable") ) {
            return;
        }
        var table = $('#reportDoneTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Report%20Done",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "adjuster" },
                { data: "serviceType" },
                { data: "serviceDate" },     
                { data: "invoiceSent" },
                { data: "trialDate" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 5, render:  renderCellAsDate},
                { targets: 7, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineAwaitingDepositionTab() {
        if ($.fn.DataTable.isDataTable("#awaitingDepositionTable") ) {
            return;
        }
        var table = $('#awaitingDepositionTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting20Deposition",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "futureService" }, 
                { data: "futureServiceVenue" }, 
                { data: "futureServiceDate" }, 
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ], 
            columnDefs: [
                { targets: 5, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineAwaitingArbitrationTab() {
        if ($.fn.DataTable.isDataTable("#awaitingArbitrationTable") ) {
            return;
        }
        var table = $('#awaitingArbitrationTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Arbitration",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" }, 
                { data: "futureService" }, 
                { data: "futureServiceVenue" }, 
                { data: "futureServiceDate" },                 
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ], 
            columnDefs: [
                { targets: 5, render:  renderCellAsDate},
            ],     
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }    

    function defineAwaitingTrialTab() {
        if ($.fn.DataTable.isDataTable("#awaitingTrialTable") ) {
            return;
        }
        var table = $('#awaitingTrialTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Awaiting%20Trial",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" }, 
                { data: "futureService" }, 
                { data: "futureServiceVenue" }, 
                { data: "futureServiceDate" },                 
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ], 
            columnDefs: [
                { targets: 6, render:  renderCellAsDate},
            ],      
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineClosedTab() {
        if ($.fn.DataTable.isDataTable("#closedTable") ) {
            return;
        }
        var table = $('#closedTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getRecords&status=Closed",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "clientName" },
                { data: "expertName" },
                { data: "paymentReceived" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 1 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineAllCasesTab() {
        if ($.fn.DataTable.isDataTable("#allCasesTable") ) {
            return;
        }
        var table = $('#allCasesTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getAllRecords",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            // dom: 'Bfrtip',
            select: {
                style: "single",
            },
            columns: [
                { data: "caseName" },
                { data: "dateOpened" },
                { data: "clientName" },
                { data: "trialVenue" },
                { data: "trialDate" },
                { data: "expertName" },
                { data: "serviceType" },
                { data: "serviceDate" },
                { data: "caseStatus" },
                { data: "schedulingStatus" },
                { data: "futureService" },
                { data: "futureServiceDate" },
                { data: "recordsDue" },                                
                { data: "reportDone" },                                
                { data: "invoiceSent" },
                { data: "paymentReceived" },
                { data: "id",
                  visible:false
                },
                { data: "contact",
                  visible:false
                },
                { data: "expertAddress",
                  visible:false
                },
            ],
            columnDefs: [
                { targets: 1, render:  renderCellAsDate},
                { targets: 4, render:  renderCellAsDate},
                { targets: 7, render:  renderCellAsDate},
                { targets: 11, render:  renderCellAsDate},
                { targets: 12, render:  renderCellAsDate},
            ],              
            drawCallback: function () {
                var api = this.api();
                api.rows( { page: 'current' } ).every( function () {
                    var record = this.data();
                    if (record.contact) {
                        api.cell( this.index(), 2 ).node().setAttribute( 'title', "Contact is " + record.contact);
                    }
                    if (record.expertAddress) {
                        api.cell( this.index(), 5 ).node().setAttribute( 'title', "The address is " + record.expertAddress);                    
                    }
                });
            },
        });

        defineTableEvents(table);
    }

    function defineTableEvents(table) {
        table.on('draw.dt', function () {
            $('[data-toggle="tooltip"]').tooltip();
        }).on( 'select', function ( e, dt, type, indexes ) {
            $("#editRecordBtn").removeAttr("disabled");
            $("#logRecordsBtn").removeAttr("disabled");
            $("#schedulingBtn").removeAttr("disabled");
            $("#billingBtn").removeAttr("disabled");
            $("#deleteRecordBtn").removeAttr("disabled");

            _selectedRecord = table.rows(indexes).data().toArray()[0];    

            $("#id-to-be-removed").val(_selectedRecord.id);
            //For debug
            //events.prepend( '<div><b>'+type+' selection</b> - '+JSON.stringify( _selectedRecord )+'</div>' );
        }).on( 'deselect', function ( e, dt, type, indexes ) {
            tableDeselect();
        });
    }

    function tableDeselect() {
        _selectedRecord = null;
        $("#editRecordBtn").attr("disabled", "disabled");
        $("#deleteRecordBtn").attr("disabled", "disabled");
        $("#logRecordsBtn").attr("disabled", "disabled");
        $("#schedulingBtn").attr("disabled", "disabled");
        $("#billingBtn").attr("disabled", "disabled");
        $("#id-to-be-removed").val(null);
    }

    function setupNewRecordButton(){
        $("#newRecordBtn").off("click");
        $("#newRecordBtn").click(setupNewRecordForm);
    }

    function setupEditRecordButton(){
        $("#editRecordBtn").off("click");
        $("#editRecordBtn").click(setupEditRecordForm);
    }

    function setupEditFormValidationSupport() {
        $("#caseStatus-edit").on("change", function() {
            onCaseStatusEditChange();
        });

        $("#edit-record-form").validator({
            custom: {
                equals: function($el) {
                    var matchValue = $el.attr('data-equals');
                    if ($el.val() !== matchValue) {
                        return "This should be  " + matchValue;
                    }
                },
                recordStatus: function($el) {
                    var caseStatus = $("#caseStatus-edit").val();    
                    if (caseStatus == "Awaiting Trial" || caseStatus == "Closed") {
                        var recordStatus = $("#recordStatus-edit").val();    
                        if (recordStatus != "Need to retrieve from expert" && recordStatus != "Shredded") {
                            return "This should be 'Need to retrieve from expert' or 'Shredded'";           
                        }
                    } 
                },
                reportDone: function($el) {
                    var caseStatus = $("#caseStatus-edit").val();  
                    if (caseStatus == "Report Done") {
                        var reportDone = $("#reportDone-edit").val();    
                        if (reportDone != "Yes" && reportDone != "N/A") {
                           return "This should be 'Yes' or 'N/A'";                
                        }    
                    }
                },            
            }
        });


        $("#edit-record-form").validator().on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                $("#save-edit-btn").attr("disabled", "disabled");
                saveRecord();
                e.preventDefault();
            }
        });
    }
    
    function onCaseStatusEditChange() {
        $("#edit-record-form :input").removeAttr("required");
        _statusesData[$("#caseStatus-edit").val()].requiredFields.forEach(function(elem){
            $(elem).attr("required", "required");            
        });
        $("#edit-record-form :input").removeAttr("data-equals");
        _statusesData[$("#caseStatus-edit").val()].requiredValues.forEach(function(elem){
            $(elem.field).attr("data-equals", elem.value);            
        });


        $("#edit-record-form").validator('update');
        $("#edit-record-form").validator('validate');
    }     

    function setupDeleteRecordButton(){
        $("#delete-btn").off("click");
        $("#delete-btn").click(deleteRecord);
    }

    function deleteRecord(event) {
        $("#delete-record-modal").modal('hide');
        $.blockUI({message:null, baseZ: 2000});

        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",              
            data: {
                action: "deleteRecord",
                id: $("#id-to-be-removed").val(),
            },
            success: function(response) {
                console.log("Success!");
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                }
                activate(_currentTab);
                $.unblockUI();
            }
        });
    } 

    function setupNewRecordForm() {

        $("#new-record-form")[0].reset();

        loadContactValues("#client", _clients);
        $("#client").combobox();

		loadContactValues("#expert", _experts);
        $("#expert").combobox();

        $("#trialDate").datepicker();
        $("#trialDate").attr("readonly", true);

        $("#new-record-form").validator('update');
        $('#new-record-form').validator().on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                $("#create-btn").attr("disabled", "disabled");
                newRecord();
                e.preventDefault();
            }
        });
    }

    function newRecord(event) {
        $.blockUI({message:null, baseZ: 2000});

        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",              
            data: {
                action: "newRecord",
                caseName: $("#caseName").val(),
                clientId: $("#client").val(),
                expertId: $("#expert").val(),
                trialVenue: $("#trialVenue").val(),
                trialDate: $("#trialDate").val(),
                claimsOfInjury: $("#claimsOfInjury").val(),
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                }                
                $("#create-btn").removeAttr("disabled");
                $("#new-record-modal").modal('hide');
                activate("awaitingScheduling");
                $.unblockUI();
            }
        });
    }

    function loadContactValues(selectId, values, required) {
        var select = $(selectId);
        select .html('');
        if (!required) {
            select.append($('<option>', { value : "", text: "" }));
        }    
        values.forEach(function(elem, i){
            select.append($('<option>', { 
                value: elem.contactId,
                text : elem.name
            }));
        });
    }


    function loadSelectValues(selectId, values, required) {
        var select = $(selectId);
        select .html('');
        if (!required) {
            select.append($('<option>', { value : "", text: "" }));
        }    
        values.forEach(function(elem, i){
            select.append($('<option>', { 
                value: elem.name,
                text : elem.name
            }));
        });
    }

    function setupDateField(dateFieldId, value) {
        if (value) {
            $(dateFieldId).val(moment(value).tz(TIMEZONE).format("MM/DD/YYYY"));
        }    
        $(dateFieldId).datepicker();
        $(dateFieldId).attr("readonly", true);
    }

    function setupEditRecordForm() {

        $("#edit-record-form")[0].reset();
        $("#id-edit").val(_selectedRecord.id);
        
        //CASE DETAILS GROUP- BEGIN

        $("#caseName-edit").val(_selectedRecord.caseName);

        setupDateField("#dateOpened-edit", _selectedRecord.dateOpened);

        loadContactValues("#client-edit", _clients);
        $("#client-edit").val(_selectedRecord.clientId);

        $("#client-edit").combobox();
        $("#client-edit").combobox("instance").refresh();

        $("#adjuster-edit").val(_selectedRecord.adjuster);
        $("#clientReferenceNumber-edit").val(_selectedRecord.clientReferenceNumber);

		$("#claimantName-edit").val(_selectedRecord.claimantName);
		$("#claimantCOR-edit").val(_selectedRecord.claimantCOR);
		setupDateField("#claimantDOB-edit", _selectedRecord.claimantDOB);

        $("#trialVenue-edit").val(_selectedRecord.trialVenue);
        setupDateField("#trialDate-edit", _selectedRecord.trialDate);
        $("#plaintifAttorney-edit").val(_selectedRecord.plaintifAttorney);

        setupDateField("#dateOfLoss-edit", _selectedRecord.dateOfLoss);
        $("#claimsOfInjury-edit").val(_selectedRecord.claimsOfInjury);

        loadContactValues("#expert-edit", _experts);
        $("#expert-edit").val(_selectedRecord.expertId);
        $("#expert-edit").combobox();
        $("#expert-edit").combobox("instance").refresh();

        loadSelectValues("#serviceType-edit", _catalogs["ServiceTypesRange"]);
        $("#serviceType-edit").val(_selectedRecord.serviceType);

        setupDateField("#serviceDate-edit", _selectedRecord.serviceDate);

        loadSelectValues("#translator-edit", _catalogs["TranslatorStatusRange"]);
		$("#translator-edit").val(_selectedRecord.translator);

        //CASE DETAILS GROUP- END
        //CASE STATUS GROUP- BEGIN

        loadSelectValues("#caseStatus-edit", _catalogs["CaseStatusesRange"], true);
        $("#caseStatus-edit").val(_selectedRecord.caseStatus);

        //CASE STATUS GROUP- END 
		//SCHEDULING GROUP - BEGIN

        loadSelectValues("#schedulingStatus-edit", _catalogs["SchedulingStatusesRange"]);
        $("#schedulingStatus-edit").val(_selectedRecord.schedulingStatus);

        loadSelectValues("#futureService-edit", _catalogs["FutureServiceRange"]);
        $("#futureService-edit").val(_selectedRecord.futureService);

        $("#futureServiceVenue-edit").val(_selectedRecord.futureServiceVenue);

        setupDateField("#futureServiceDate-edit", _selectedRecord.futureServiceDate);

		//SCHEDULING GROUP - END

		//RECORDS AND REPORTS GROUP - BEGIN

		setupDateField("#recordsDue-edit", _selectedRecord.recordsDue);
		$("#contact-edit").val(_selectedRecord.contact);

        loadSelectValues("#recordsReceived-edit", _catalogs["ReceptionStatusesRange"]);
        $("#recordsReceived-edit").val(_selectedRecord.recordsReceived);
        loadSelectValues("#recordStatus-edit", _catalogs["RecordStatusesRange"]);
        $("#recordStatus-edit").val(_selectedRecord.recordStatus);

        $("#indexer-edit").val(_selectedRecord.indexer);
        $("#hoursSpentIndexing-edit").val(_selectedRecord.hoursSpentIndexing);

        loadSelectValues("#reportDone-edit", _catalogs["ReportDoneRange"]);
        $("#reportDone-edit").val(_selectedRecord.reportDone);
        loadSelectValues("#reportFormat-edit", _catalogs["ReportFormatRange"]);
        $("#reportFormat-edit").val(_selectedRecord.reportFormat);

		//RECORDS AND REPORTS GROUP - END		

		//BILLING GROUP - BEGIN

		loadSelectValues("#invoiceSent-edit", _catalogs["InvoiceSentRange"]);
        $("#invoiceSent-edit").val(_selectedRecord.invoiceSent);
        setupDateField("#dateOfInvoice-edit", _selectedRecord.dateOfInvoice);

		loadSelectValues("#paymentReceived-edit", _catalogs["PaymentReceivedRange"]);
        $("#paymentReceived-edit").val(_selectedRecord.paymentReceived);
        setupDateField("#paymentReceivedDate-edit", _selectedRecord.paymentReceivedDate);

		//BILLING GROUP - END 

        onCaseStatusEditChange();
    }

    function saveRecord(event) {
        $.blockUI({message:null, baseZ: 2000});

        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",  
            data: {
                action: "updateRecord",
				id:$("#id-edit").val(),
				caseName:$("#caseName-edit").val(),
				dateOpened:$("#dateOpened-edit").val(),
				clientId:$("#client-edit").val(),
				adjuster:$("#adjuster-edit").val(),
				clientReferenceNumber:$("#clientReferenceNumber-edit").val(),
				claimantName:$("#claimantName-edit").val(),
				claimantCOR:$("#claimantCOR-edit").val(),
				claimantDOB:$("#claimantDOB-edit").val(),
				trialVenue:$("#trialVenue-edit").val(),
				trialDate:$("#trialDate-edit").val(),
				dateOfLoss:$("#dateOfLoss-edit").val(),
				claimsOfInjury:$("#claimsOfInjury-edit").val(),
				plaintifAttorney:$("#plaintifAttorney-edit").val(),
				expertId:$("#expert-edit").val(),
				expertAddress:$("#expertAddress-edit").val(),
				serviceType:$("#serviceType-edit").val(),
				serviceDate:$("#serviceDate-edit").val(),
				translator:$("#translator-edit").val(),
				caseStatus:$("#caseStatus-edit").val(),
				schedulingStatus:$("#schedulingStatus-edit").val(),
				futureService:$("#futureService-edit").val(),
				futureServiceVenue:$("#futureServiceVenue-edit").val(),
				futureServiceDate:$("#futureServiceDate-edit").val(),
				recordsDue:$("#recordsDue-edit").val(),
				contact:$("#contact-edit").val(),
				recordsReceived:$("#recordsReceived-edit").val(),
				recordStatus:$("#recordStatus-edit").val(),
				indexer:$("#indexer-edit").val(),
				hoursSpentIndexing:$("#hoursSpentIndexing-edit").val(),
				reportDone:$("#reportDone-edit").val(),
				reportFormat:$("#reportFormat-edit").val(),
				invoiceSent:$("#invoiceSent-edit").val(),
				dateOfInvoice:$("#dateOfInvoice-edit").val(),
				paymentReceived:$("#paymentReceived-edit").val(),
				paymentReceivedDate:$("#paymentReceivedDate-edit").val(),
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                }                
                $("#save-edit-btn").removeAttr("disabled");
                $("#edit-record-modal").modal('hide');
                activate(_statusesData[$("#caseStatus-edit").val()].tab);
                $.unblockUI();
            }
        });
    }

    //*********** LOG RECORDS BEGIN ****************//

    function setupLogRecordsButtons(){

        $("#logRecordsBtn").off("click");
        $("#logRecordsBtn").click(setupLogRecordForm);

        $("#add_logrecord-btn").off("click");
        $("#add_logrecord-btn").click(function(){
            loadSelectValues("#format", _catalogs["ReceivedFormatsRange"]);
            loadSelectValues("#logger", _catalogs["LoggersRange"]);
            loadSelectValues("#recordReceived", _catalogs["RecordReceivedRange"], true);
            $("#logRecordItem-form")[0].reset();
            $("#lri-action").val("add");
        });

        $("#paymentReceivedDate").datepicker();
        $("#paymentReceivedDate").attr("readonly", true);

        $("#dateSent").datepicker();
        $("#dateSent").attr("readonly", true);

        $("#edit_logrecord-btn").off("click");
        $("#edit_logrecord-btn").click(function(){
            loadSelectValues("#format", _catalogs["ReceivedFormatsRange"]);
            loadSelectValues("#logger", _catalogs["LoggersRange"]);
            loadSelectValues("#recordReceived", _catalogs["RecordReceivedRange"], true);

            var table = $("#logRecordTable").DataTable();
            var idx = table.cell('.selected', 0).index();
            var data = table.row( idx.row ).data();

            $("#lri-action").val("edit");
            $("#format").val(data.format);
            $("#recordDetails").val(data.recordDetails);
            $("#paymentReceivedDate").val(data.paymentReceivedDate);
            $("#logger").val(data.logger);
            $("#recordReceived").val(data.recordReceived);
            $("#dateSent").val(data.dateSent);

        });

        $("#remove_logrecord-btn").off("click");
        $("#remove_logrecord-btn").click(function(){
            var table = $("#logRecordTable").DataTable();
            var idx = table.cell('.selected', 0).index();
            table.row(idx.row).remove().draw(false);
        });
    }

    //this has to be different due to the storage being different
    function renderLogrecordCellAsDate(data, type, row, meta) {
        
        if ( type === 'display' || type === 'filter' ) {
            if (!data){
                return ""; 
            }    
            return moment(data, "MM/DD/YYYY").format('MMMM Do YYYY');
        }
        return data;    
    }                

    function defineLogRecordsDialog() {
        if ($.fn.DataTable.isDataTable("#logRecordTable") ) {
            return;
        }
        var table = $('#logRecordTable').DataTable({
            processing: true,
            deferLoading: 0,
            dom: 't',
            select: {
                style: "single",
            },
            columns: [
                { data: "format" },
                { data: "recordDetails" },
                { data: "paymentReceivedDate" },
                { data: "logger",
                  visible:false
                },
                { data: "recordReceived" },
                { data: "dateSent" },
            ],
            columnDefs: [
                { targets: 2, render:  renderLogrecordCellAsDate},
                { targets: 5, render:  renderLogrecordCellAsDate},
            ],     
        });
        definelogRecordTableEvents(table); 

        $("#logrecord-form").validator("update");
        $("#logrecord-form").validator().on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                saveLogRecord() 
                e.preventDefault();
            }
        });

        $('#logRecordItem-form').validator().on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                $("#save-logrecorditem-btn").attr("disabled", "disabled");
                var table = $("#logRecordTable").DataTable();  
                if ($("#lri-action").val() == "add") {
                    table.row.add({
                        format:$("#format").val(),
                        recordDetails:$("#recordDetails").val(),
                        paymentReceivedDate:$("#paymentReceivedDate").val(),
                        logger:$("#logger").val(),
                        recordReceived:$("#recordReceived").val(),
                        dateSent:$("#dateSent").val(),
                    });
                } else {
                    var idx = table.cell('.selected', 0).index();
                    var data = table.row(idx.row).data();
                    data.format = $("#format").val();
                    data.recordDetails = $("#recordDetails").val();
                    data.paymentReceivedDate = $("#paymentReceivedDate").val();
                    data.logger = $("#logger").val();
                    data.recordReceived = $("#recordReceived").val();
                    data.dateSent = $("#dateSent").val();
                    table.row(idx.row).invalidate();
                }
                table.draw();
                $("#logRecordItem-modal").modal('hide');
                $("#save-logrecorditem-btn").removeAttr("disabled");
                e.preventDefault();
            }
        });
    }

    function definelogRecordTableEvents(table) {
        table.on( 'select', function () {
            $("#edit_logrecord-btn").removeAttr("disabled");
            $("#remove_logrecord-btn").removeAttr("disabled");
        }).on( 'deselect', function () {
            $("#edit_logrecord-btn").attr("disabled", "disabled");
            $("#remove_logrecord-btn").attr("disabled", "disabled");
        });    
    }

    function setupLogRecordForm() {

        $("#logrecord-form")[0].reset();
        var table = $("#logRecordTable").DataTable();
        table.clear();

        loadSelectValues("#formatReceived", _catalogs["ReceivedFormatsRange"]);
        loadSelectValues("#doctorNotified", _catalogs["DoctorNotifiedRange"]);

        //These come from the main row
        $("#formatToSend").val(_selectedRecord.formatToSend);    
        $("#expertAddress").val(_selectedRecord.expertAddress);    
        $("#recordStatus").val(_selectedRecord.recordStatus);    

        if (_selectedRecord.formatReceived) {
            var data = JSON.parse(_selectedRecord.formatReceived);        
            $("#currentStatus").val(data.currentStatus);    
            $("#formatReceived").val(data.formatReceived);    
            $("#doctorNotified").val(data.doctorNotified);    

            data.rows.forEach(function(elem){
                table.row.add(elem);
            });
        }

        table.draw(false);
        $("#logrecord-form").validator("update");

        $("#edit_logrecord-btn").attr("disabled", "disabled");
        $("#remove_logrecord-btn").attr("disabled", "disabled");
    }

    function saveLogRecord() {

        $.blockUI({message:null, baseZ: 2000});


        $("#save_logrecord-btn").attr("disabled", "disabled");

        var logRecord = {};
        logRecord.currentStatus = $("#currentStatus").val();
        logRecord.formatReceived = $("#formatReceived").val();
        logRecord.doctorNotified = $("#doctorNotified").val();
        logRecord.rows = [];
        var table = $("#logRecordTable").DataTable();  
        table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
            var aRow = this.data();
            logRecord.rows.push({
                format: aRow.format,
                recordDetails: aRow.recordDetails,
                paymentReceivedDate: aRow.paymentReceivedDate,
                logger: aRow.logger,
                recordReceived: aRow.recordReceived,
                dateSent: aRow.dateSent,
            });
        });

        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",  
            data: {
                action: "updateLogRecord",
                id: _selectedRecord.id,
                logRecord: JSON.stringify(logRecord),
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                }                
                $("#logrecord-modal").modal('hide');
                $("#save_logrecord-btn").removeAttr("disabled");
                activate(_statusesData[_selectedRecord.caseStatus].tab);
                $.unblockUI();
            }
        });

    }

    //*********** LOG RECORDS END ******************//

    //*********** CONTACTS UI BEGIN ****************//

    //TODO: Nice to have list:
    // - refresh the contact list in real time
    // - check if the contact is being used before deleting it
    function setupContactsButtons(){

        $("#contactsBtn").off("click");
        $("#contactsBtn").click(setupContactsDialog);

        $("#add_contact-btn").off("click");
        $("#add_contact-btn").click(function(){
            loadSelectValues("#contactType", _catalogs["ContactTypesRange"]);
            loadSelectValues("#contactPreferredFormat", _catalogs["PreferredFormatsRange"]);
            $("#contact-form")[0].reset();
            $("#contact-action").val("add");
        });

        $("#edit_contact-btn").off("click");
        $("#edit_contact-btn").click(function(){
            var table = $("#contactsTable").DataTable();
            var idx = table.cell('.selected', 0).index();
            var data = table.row( idx.row ).data();

            loadSelectValues("#contactType", _catalogs["ContactTypesRange"]);
            loadSelectValues("#contactPreferredFormat", _catalogs["PreferredFormatsRange"]);

            $("#contact-action").val("edit");
            $("#contactId").val(data.contactId);
            $("#contactType").val(data.contactType);
            $("#contactName").val(data.contactName);
            $("#contactEmail").val(data.contactEmail);
            $("#contactPostalAddress").val(data.contactPostalAddress);
            $("#contactPreferredFormat").val(data.contactPreferredFormat);
            $("#name").val(data.name);
        });

        $("#delete-contact-btn").off("click");
        $("#delete-contact-btn").click(function(){
            var table = $("#contactsTable").DataTable();
            var idx = table.cell('.selected', 0).index();
            var contactId = table.row(idx.row).data().contactId;
            deleteContact(contactId);
        });
    }

    function deleteContact(contactId) {
        $("#delete-contact-modal").modal('hide');
        $.blockUI({message:null, baseZ: 2000});
        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",              
            data: {
                action: "deleteContact",
                contactId: contactId,
            },
            success: function(response) {
                console.log("Success!");
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                }
                $("#contactsTable").DataTable().ajax.reload();
                $.unblockUI();
            }
        });
    } 

    function setupContactsDialog() {
        $("#contactsTable").DataTable().ajax.reload();
        $("#edit_contact-btn").attr("disabled", "disabled");
        $("#remove_contact-btn").attr("disabled", "disabled");
    }

    function saveContact(){

    }

    function defineContactsDialog() {
        if ($.fn.DataTable.isDataTable("#contactsTable") ) {
            return;
        }
        var table = $('#contactsTable').DataTable({
            ajax: {
                url: WEBAPP_URL+"?action=getAllContacts",
                dataType: "jsonp",
            },            
            processing: true,
            deferLoading: 0,
            select: {
                style: "single",
            },
            columns: [
                { data: "contactType" },
                { data: "contactName" },
                { data: "contactId",
                  visible:false
                },
                { data: "contactEmail",
                  visible:false
                },
                { data: "contactPostalAddress" ,
                  visible:false
                },
                { data: "contactPreferredFormat",
                  visible:false
                },
            ],
        });
        defineContactsTableEvents(table); 

        $("#contact-form").validator("update");
        $('#contact-form').validator().on('submit', function (e) {
            if (!e.isDefaultPrevented()) {
                $("#save-contact-btn").attr("disabled", "disabled");
                var table = $("#contactsTable").DataTable();  
                if ($("#contact-action").val() == "add") {
                    $("#contact-modal").modal('hide');
                    $.blockUI({message:null, baseZ: 2000});
                    $.ajax({
                        url: WEBAPP_URL,
                        jsonp: "callback",
                        dataType: "jsonp",              
                        data: {
                            action: "newContact",
                            contactType:$("#contactType").val(),
                            contactName:$("#contactName").val(),
                            contactEmail:$("#contactEmail").val(),
                            contactPostalAddress:$("#contactPostalAddress").val(),
                            contactPreferredFormat:$("#contactPreferredFormat").val(),
                        },
                        success: function(response) {
                            console.log("Success!");
                            if (response.code != "OK") {
                                alert("Problems when talking with the server: " +response.data);
                            }
                            $("#contactsTable").DataTable().ajax.reload();
                            $.unblockUI();
                        }
                    });

                } else {
                    var idx = table.cell('.selected', 0).index();
                    var contactId = table.row(idx.row).data().contactId;
                    $("#contact-modal").modal('hide');
                    $.blockUI({message:null, baseZ: 2000});
                    $.ajax({
                        url: WEBAPP_URL,
                        jsonp: "callback",
                        dataType: "jsonp",              
                        data: {
                            action: "updateContact",
                            contactId:$("#contactId").val(),
                            contactType:$("#contactType").val(),
                            contactName:$("#contactName").val(),
                            contactEmail:$("#contactEmail").val(),
                            contactPostalAddress:$("#contactPostalAddress").val(),
                            contactPreferredFormat:$("#contactPreferredFormat").val(),
                        },
                        success: function(response) {
                            console.log("Success!");
                            if (response.code != "OK") {
                                alert("Problems when talking with the server: " +response.data);
                            }
                            $("#contactsTable").DataTable().ajax.reload();
                            $.unblockUI();
                        }
                    });
                }
                $("#save-contact-btn").removeAttr("disabled");
                e.preventDefault();
            }
        });
    }

    function defineContactsTableEvents(table) {
        table.on( 'select', function () {
            $("#edit_contact-btn").removeAttr("disabled");
            $("#remove_contact-btn").removeAttr("disabled");
        }).on( 'deselect', function () {
            $("#edit_contact-btn").attr("disabled", "disabled");
            $("#remove_contact-btn").attr("disabled", "disabled");
        });    
    }

    //*********** CONTACTS UI END ****************//

    function activate(tab) {
        console.log("activate("+tab+")" );
        if (tab === "logs") {
            activateLogs();
        } else {
            var defineFunctionName = "define"+tab[0].toUpperCase() + tab.substring(1)+"Tab";
            console.log("defineFunctionName "+defineFunctionName);
            window[defineFunctionName]();
            $("#"+tab+"Table").DataTable().ajax.reload();
            //activates the tab if it is not already the active one
            var index = $("#tabs a[href='#"+tab+"']").parent().index();
            $("#tabs").tabs("option", "active", index);
        } 
        tableDeselect();
    }

    function activateLogs() {
        $.blockUI({message:null, baseZ: 2000});

        $.ajax({
            url: WEBAPP_URL,
            jsonp: "callback",
            dataType: "jsonp",
            data: {
                action: "getLogs",
                last: 50
            },
            success: function(response) {
                if (response.code != "OK") {
                    alert("Problems when talking with the server: " +response.data);
                     $.unblockUI();
                    return;
                }
                $("#logsTable td").parent().remove();
                var tableBody = $('#logsTable tbody');
                response.data.forEach(function(row) {
                    tableBody.append(
                        $('<tr>').append(
                            $('<td style="white-space: nowrap;">').append(
                                moment(row.timestamp).tz(TIMEZONE).format("MM/DD/YYYY hh:mm:ss")
                            )
                        ).append(
                            $('<td>').append(row.level)
                        ).append(
                            $('<td>').append(row.message)
                        )
                    );
                });
                $.unblockUI();
            }
        });
    }        
    </script>
    <style>
        .glyphicon-alert, .glyphicon-ok {
            transform:scale(1.5,1.5);
            -ms-transform:scale(1.5,1.5); /* IE 9 */
            -moz-transform:scale(1.5,1.5); /* Firefox */
            -webkit-transform:scale(1.5,1.5); /* Safari and Chrome */
            -o-transform:scale(1.5,1.5); /* Opera */
        }

        .ui-datepicker { width: 17em; padding: .2em .2em 0; z-index: 9999 !important; }

        .modal-backdrop {
            visibility: hidden !important;
        }

        .modal.in {
            background-color: rgba(0,0,0,0.5);
        }

		legend {
			padding: 20 0 0 0;
			margin-bottom: 0;
		}

		.controlgroup {
			border-style: dashed;
			padding:10; 
		}

        .ui-autocomplete {
            position: absolute;
            z-index: 2150000000 !important;
            cursor: default;
            border: 2px solid #ccc;
            padding: 5px 0;
            border-radius: 2px;
        }

        .custom-combobox {
            position: relative;
            display: inline-block;
        }
        .custom-combobox-input {
            margin: 0;
            padding: 5px 10px;
        }

    </style>
</head>

<body>
    <div id="tabs">
        <ul>
            <li><a href="#awaitingScheduling">Awaiting Scheduling</a></li>
            <li><a href="#awaitingRecords">Awaiting Records</a></li>
            <li><a href="#awaitingIndexing">Awaiting Indexing</a></li>
            <li><a href="#awaitingShipment">Awaiting Shipment</a></li>
            <li><a href="#recordShipped">Records Shipped</a></li>
            <li><a href="#awaitingReport">Awaiting Report</a></li>
            <li><a href="#reportDone">Report Done</a></li>
            <li><a href="#awaitingDeposition">Awaiting Deposition</a></li>
            <li><a href="#awaitingArbitration">Awaiting Arbitration</a></li>
            <li><a href="#awaitingTrial">Awaiting Trial</a></li>
            <li><a href="#closed">Closed</a></li>
            <li><a href="#allCases">All Cases</a></li>
            <li><a href="#logs">Log</a></li>
        </ul>
        <div id="events"></div>
        <div id="awaitingScheduling">
            <table id="awaitingSchedulingTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Trial Venue</th>
                        <th>Trial Date</th>
                        <th>Scheduling Status</th>
                        <th>Service Type</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>
        <div id="awaitingRecords">
            <table id="awaitingRecordsTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>
                        <th>Records Due</th>
                        <th>Contact</th>
                        <th>Records Received</th>
                        <th>Records Status</th>
                        <th>Id</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>
        <div id="awaitingIndexing">
            <table id="awaitingIndexingTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>
                        <th>Records Due</th>
                        <th>Indexer</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>
        <div id="awaitingShipment">
            <table id="awaitingShipmentTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>
                        <th>Records Due</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>        
        <div id="recordShipped">
            <table id="recordShippedTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div> 
        <div id="awaitingReport">
            <table id="awaitingReportTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>
                        <th>Report Format</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div> 
        <div id="reportDone">
            <table id="reportDoneTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Adjuster</th>
                        <th>Service Type</th>
                        <th>Service Date</th>                        
                        <th>Invoice Sent</th>
                        <th>Trial Date</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>        
        <div id="awaitingDeposition">
            <table id="awaitingDepositionTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Future Service</th>
                        <th>FS Venue</th>
                        <th>FS Date</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>    
		<div id="awaitingArbitration">
            <table id="awaitingArbitrationTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Future Service</th>
                        <th>FS Venue</th>
                        <th>FS Date</th>                        
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>  
        <div id="awaitingTrial">
            <table id="awaitingTrialTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Future Service</th>
                        <th>FS Venue</th>
                        <th>FS Date</th>                        
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>        
        <div id="closed">
            <table id="closedTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Client</th>
                        <th>Expert</th>
                        <th>Invoice Received</th>
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody/>
            </table>
        </div>   
        <div id="allCases">
            <table id="allCasesTable" class="table table-bordered table-striped nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Date Opened</th>
                        <th>Client</th>
                        <th>Trial Venue</th>                        
                        <th>Trial Date</th>
                        <th>Expert</th>
                        <th>Service Type</th>
                        <th>Service Date</th>  
                        <th>Case Status</th>  
                        <th>Scheduling Status</th>  
                        <th>Future Service</th>  
                        <th>Future Service Date</th>  
                        <th>Records Due</th>  
                        <th>Report Done</th>  
                        <th>Invoice sent</th>  
                        <th>Payment Received</th>  
                        <th>Id</th>
                        <th>Contact</th>
                        <th>Expert Address</th>
                    </tr>
                </thead>
                <tbody/>
            </table>
        </div> 

        <div id="logs">
            <table id="logsTable" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Level</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody />
            </table>
        </div>

        <button id="newRecordBtn" class="btn btn-primary" data-toggle='modal' data-target='#new-record-modal'>
            <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span>&nbsp;New
        </button>
        <button id="editRecordBtn" class="btn btn-default" data-toggle='modal' data-target='#edit-record-modal'>
            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;More details...
        </button>
        <button id="logRecordsBtn" class="btn" data-toggle='modal' data-target='#logrecord-modal'>
            <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>&nbsp;Records...
        </button>
        <button id="schedulingBtn" class="btn" data-toggle='modal' data-target='#scheduling-modal'>
            <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>&nbsp;Scheduling...
        </button>
        <button id="billingBtn" class="btn" data-toggle='modal' data-target='#billing-modal'>
            <span class="glyphicon glyphicon-usd" aria-hidden="true"></span>&nbsp;Billing...
        </button>
        <button id="deleteRecordBtn" class="btn btn-danger" data-toggle='modal' data-target='#delete-record-modal'>
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>&nbsp;Delete
        </button>
        <button id="contactsBtn" class="btn btn-info" data-toggle="modal" data-target='#contacts-modal'>
            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>&nbsp;Contacts...
        </button>        
    <div class="modal fade" id="new-record-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div id="new-record-content" class="modal-content">
                
                <form id="new-record-form" data-toggle="validator" data-disable="true" role="form" name="modalForm" action="#" >

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span aria-hidden="true" class="">x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">New Record</h4>
                </div>
                <div id="new-record-body" class="modal-body">

					<div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="name">Case Name</label>
                                <div class="input-group">
                                    <input class="form-control" name="caseName" id="caseName" required />
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>  
                    <div class="row">
                        <div class="col-md-4">                      
		                    <div class="form-group has-feedback">
		                        <label for="client">Client</label>
		                        <div class="input-group">	
                                    <select class="form-control" name="client" id="client" required></select>
		                            <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                            <div class="help-block with-errors"></div>
		                        </div>
		                    </div>
                        </div>    
                    </div>    
                    <div class="row">
		                <div class="col-md-4">                      
		                    <div class="form-group">
		                        <label for="expert">Expert</label>
		                        <div class="input-group">
		                            <select class="form-control" name="expert" id="expert"></select>
		                        </div>
		                    </div>
                        </div>
                    </div>  
					<div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="trialVenue">Trial venue</label>
                                <div class="input-group">
                                    <input class="form-control" name="trialVenue" id="trialVenue" required/>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div> 
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="trialDate">Trial date</label>
                                <div class="input-group">
                                    <input class="form-control" name="trialDate" id="trialDate"/>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>                        
                            </div> 
                        </div>
					</div>
					<div class="row">
                        <div class="col-md-12">
                            <div class="form-group has-feedback">
                                <label for="claimsOfInjury">Claims of Injury</label>
                                <div class="input-group">
                                    <textarea class="form-control" name="claimsOfInjury" id="claimsOfInjury" cols="120" rows="4"></textarea>
                                </div>
                            </div>
                        </div>
					</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="create-btn" type="submit" class="btn btn-primary">Create record</button>
                </div>

                </form>

            </div>
        </form>
        </div>
    </div>    
    <div class="modal fade" id="edit-record-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div id="edit-record-content" class="modal-content">
                
                <form id="edit-record-form" data-disable="true" role="form" name="modalForm" action="#" >
                    <input type="hidden" name="id" id="id-edit" value="" />

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span aria-hidden="true" class="">x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">More details</h4>
                </div>
                <div id="edit-record-body" class="modal-body">

					<fieldset>
					    <legend>Case details</legend>
						<div class="controlgroup" style="background-color: lightblue;">
							<div class="row">
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="name">Case Name</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="caseName" id="caseName-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="dateOpened">Date Opened</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="dateOpened" id="dateOpened-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
							</div>	
							<div class="row">
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="client">Client</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="client" id="client-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="adjuster">Adjuster</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="adjuster" id="adjuster-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="clientReferenceNumber">Client ref. number</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="clientReferenceNumber" id="clientReferenceNumber-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>		                        
							</div>	
							<div class="row">
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="claimantName">Claimant Name</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="claimantName" id="claimantName-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="claimantCOR">City of Residence</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="claimantCOR" id="claimantCOR-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="claimantDOB">Date of Birth</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="claimantDOB" id="claimantDOB-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>		                        
							</div>			
							<div class="row">
		                        <div class="col-md-12">
		                            <div class="form-group has-feedback">
		                                <label for="plaintifAttorney">Plaintiff Attorney</label>
		                                <div class="input-group">
		                                	<textarea class="form-control" name="plaintifAttorney" id="plaintifAttorney-edit" cols="120" rows="4"></textarea>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div> 
		                        </div>
							</div>
							<div class="row">
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="trialVenue">Trial venue</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="trialVenue" id="trialVenue-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div> 
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="trialDate">Trial date</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="trialDate" id="trialDate-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>                        
		                            </div> 
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="dateOfLoss">Date of Loss</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="dateOfLoss" id="dateOfLoss-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div> 
		                        </div>
							</div>
							<div class="row">
		                        <div class="col-md-12">
		                            <div class="form-group has-feedback">
		                                <label for="claimsOfInjury">Claims of Injury</label>
		                                <div class="input-group">
		                                    <textarea class="form-control" name="claimsOfInjury" id="claimsOfInjury-edit" cols="120" rows="4"></textarea>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
							</div>
							<div class="row">
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="expert">Expert</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="expert" id="expert-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="translator">Translator</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="translator" id="translator-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>		                        
		                        <div class="col-md-2">
		                            <div class="form-group has-feedback">
		                                <label for="serviceType">Service type</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="serviceType" id="serviceType-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="serviceDate">Service date</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="serviceDate" id="serviceDate-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>
							</div>
						</div>	
					</fieldset>								
					<fieldset>
					    <legend>Case status</legend>
						<div class="controlgroup" style="background-color: lightgreen;">
		                    <div class="row">
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="caseStatus">Case status</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="caseStatus" id="caseStatus-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>
		                    </div>
						</div>	
					</fieldset>
					<fieldset>
					    <legend>Scheduling</legend>
						<div class="controlgroup" style="background-color: lightyellow;">
		                    <div class="row">
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="schedulingStatus">Scheduling status</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="schedulingStatus" id="schedulingStatus-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>
		                    </div>
		                    <div class="row">
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="futureService">Future Service</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="futureService" id="futureService-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="futureServiceVenue">FS Venue</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="futureServiceVenue" id="futureServiceVenue-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>
		                        <div class="col-md-3">
		                             <div class="form-group has-feedback">
		                                <label for="futureServiceDate">FS Date</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="futureServiceDate" id="futureServiceDate-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>		                        		                        
		                    </div>
						</div>	
					</fieldset>
					<fieldset>
					    <legend>Records And Reports</legend>
						<div class="controlgroup" style="background-color: lightSalmon;">
		                    <div class="row">
		                        <div class="col-md-3">
		                             <div class="form-group has-feedback">
		                                <label for="recordsDue">Records Due</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="recordsDue" id="recordsDue-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>			                    	
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="contact">Contact</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="contact" id="contact-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>
		                    </div>
		                    <div class="row">
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="recordsReceived">Records Received</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="recordsReceived" id="recordsReceived-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>		                    	
		                        <div class="col-md-4">
		                            <div class="form-group has-feedback">
		                                <label for="recordStatus">Records status</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="recordStatus" id="recordStatus-edit" data-recordStatus="true"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>		                    	
		                    </div>		                   
		                    <div class="row">
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="indexer">Indexer</label>
		                                <div class="input-group">
                                            <input class="form-control" name="indexer" id="indexer-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>                    	
		                       <div class="col-md-2">
		                            <div class="form-group has-feedback">
		                                <label for="hoursSpentIndexing">Hours indexing</label>
		                                <div class="input-group">
		                                    <input type="number" min="0" class="form-control" name="hoursSpentIndexing" id="hoursSpentIndexing-edit" />
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>	                    	
		                    </div>		          
		                    <div class="row">
		                        <div class="col-md-4">
		                             <div class="form-group has-feedback">
		                                <label for="reportDone">Report Done</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="reportDone" id="reportDone-edit" data-reportDone="true"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
		                        </div>                    	
		                       <div class="col-md-2">
		                            <div class="form-group has-feedback">
		                                <label for="reportFormat">Report Format</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="reportFormat" id="reportFormat-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>
		                        </div>	                    	
		                    </div>	
						</div>	
					</fieldset>					
					<fieldset>
					    <legend>Billing</legend>
							<div class="controlgroup" style="background-color: lightSteelBlue;">
							<div class="row">
		                        <div class="col-md-3">
		                            <div class="form-group has-feedback">
		                                <label for="invoiceSent">Invoice sent</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="invoiceSent" id="invoiceSent-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div> 
		                        </div>                    	
		                        <div class="col-md-3">
		                             <div class="form-group has-feedback">
		                                <label for="dateOfInvoice">Date of Invoice</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="dateOfInvoice" id="dateOfInvoice-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>                        
		                            </div> 
		                        </div> 		       
		                        <div class="col-md-3">
	                             	<div class="form-group has-feedback">
	                                	<label for="paymentReceived">Payment received</label>
		                                <div class="input-group">
		                                    <select class="form-control" name="paymentReceived" id="paymentReceived-edit"></select>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>
		                            </div>    
	                        	</div>
		                        <div class="col-md-3">
		                             <div class="form-group has-feedback">
		                                <label for="paymentReceivedDate">Payment date</label>
		                                <div class="input-group">
		                                    <input class="form-control" name="paymentReceivedDate" id="paymentReceivedDate-edit"/>
		                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
		                                    <div class="help-block with-errors"></div>
		                                </div>                        
		                            </div> 
		                        </div> 	                        	
		                   	</div>	
						</div>	
					</fieldset>	

				</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="save-edit-btn" type="submit" class="btn btn-primary">Save changes</button>
                </div>

                </form>

            </div>
        </form>
        </div>
    </div>   
    <div class="modal fade" id="delete-record-modal" tabindex="-1" role="dialog" >
        <div class="modal-dialog">
            <div class="modal-content">

                <form id="delete-record-form" role="form" name="modalForm" action="#" >

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span>x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title">Confirmation needed</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="id-to-be-removed" value="" />
                    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>This record will be permanently deleted. Are you sure?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="delete-btn" type="button" class="btn btn-primary">Do it!</button>
                </div>

                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="logrecord-modal" tabindex="-1" role="dialog" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <form id="logrecord-form" role="form" name="modalForm" action="#" >

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span>x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title">Records</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="id-logrecord" value="" />
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group has-feedback">
                                <label for="currentStatus">Current Status</label>
                                <div class="input-group">
                                    <textarea class="form-control" name="currentStatus" id="currentStatus" cols="120" rows="3" required></textarea>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="formatReceived">Format received</label>
                                <div class="input-group">
                                    <select class="form-control" name="formatReceived" id="formatReceived" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="formatToSend">Format to send</label>
                                <div class="input-group">
                                    <input class="form-control" name="formatToSend" id="formatToSend" readonly/>
                                </div>
                            </div>
                        </div>    
                    </div>           
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group has-feedback">
                                <label for="expertAddress">Expert address</label>
                                <div class="input-group">
                                    <textarea class="form-control" name="expertAddress" id="expertAddress" cols="120" rows="1" readonly></textarea>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">                        
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="recordStatus">Record status</label>
                                <div class="input-group">
                                    <input class="form-control" name="recordStatus" id="recordStatus" readonly/>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="doctorNotified">Doctor notified</label>
                                <div class="input-group">
                                    <select class="form-control" name="doctorNotified" id="doctorNotified" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>  
                    </div> 
                    <div class="row">
                        <div class="col-md-12">
                            <table id="logRecordTable" class="table table-bordered table-striped nowrap" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Format</th>
                                        <th>Record Details</th>
                                        <th>Date Received</th>
                                        <th>Logger</th>
                                        <th>Records Received</th>
                                        <th>Date Sent</th>
                                    </tr>
                                </thead>
                                <tbody/>
                            </table>
                        </div>
                    </div>    
                </div>
                <div class="modal-footer">
                    <button id="add_logrecord-btn" type="button" class="btn" data-toggle='modal' data-target='#logRecordItem-modal'>Add</button>
                    <button id="edit_logrecord-btn" type="button" class="btn" data-toggle='modal' data-target='#logRecordItem-modal'>Edit</button>
                    <button id="remove_logrecord-btn" type="button" class="btn">Remove</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="save_logrecord-btn" type="submit" class="btn btn-primary">Save</button>
                </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="logRecordItem-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div id="logRecordItem-content" class="modal-content">
                
                <form id="logRecordItem-form" data-disable="true" role="form" name="modalForm" action="#" >
                    <input type="hidden" name="lri-action" id="lri-action" value="" />

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span aria-hidden="true" class="">x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="newlogrecordModalLabel">Log Item</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="format">Format</label>
                                <div class="input-group">
                                    <select class="form-control" name="format" id="format" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="recordDetails">Record Details</label>
                                <div class="input-group">
                                    <input class="form-control" name="recordDetails" id="recordDetails" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group has-feedback">
                                <label for="paymentReceivedDate">Date Received</label>
                                <div class="input-group">
                                    <input class="form-control" name="paymentReceivedDate" id="paymentReceivedDate" required/>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>                        
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="logger">Logger</label>
                                <div class="input-group">
                                    <select class="form-control" name="logger" id="logger" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>                        
                        <div class="col-md-3">
                            <div class="form-group has-feedback">
                                <label for="recordReceived">Record Received</label>
                                <div class="input-group">
                                    <select class="form-control" name="recordReceived" id="recordReceived" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>                        
                        <div class="col-md-3">
                            <div class="form-group has-feedback">
                                <label for="dateSent">Date Sent</label>
                                <div class="input-group">
                                    <input class="form-control" name="dateSent" id="dateSent" readonly />
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="save-logrecorditem-btn" type="submit" class="btn btn-primary">Save</button>
                </div>
                </form>
            </div>
        </form>
        </div>
    </div> 
    <div class="modal fade" id="contacts-modal" tabindex="-1" role="dialog" >
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span>x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title">Contacts</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="contactsTable" class="table table-bordered table-striped nowrap" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Name</th>
                                        <th>Id</th>
                                        <th>Email</th>
                                        <th>Postal Address</th>
                                        <th>Prefered format</th>
                                    </tr>
                                </thead>
                                <tbody/>
                            </table>
                        </div>
                    </div>    
                </div>
                <div class="modal-footer">
                    <button id="add_contact-btn" type="button" class="btn" data-toggle='modal' data-target='#contact-modal'>Add</button>
                    <button id="edit_contact-btn" type="button" class="btn" data-toggle='modal' data-target='#contact-modal'>Edit</button>
                    <button id="remove_contact-btn" type="button" class="btn" data-toggle='modal' data-target="#delete-contact-modal">Remove</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="contact-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div id="contact-content" class="modal-content">
                
                <form id="contact-form" data-disable="true" role="form" name="modalForm" action="#" >
                    <input type="hidden" name="contact-action" id="contact-action" value="" />
                    <input type="hidden" name="contactId" id="contactId" value="" />

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span aria-hidden="true" class="">x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="contactModalLabel">Contact</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="contactType">Type</label>
                                <div class="input-group">
                                    <select class="form-control" name="contactType" id="contactType" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="contactName">Name</label>
                                <div class="input-group">
                                    <input class="form-control" name="contactName" id="contactName" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="contactEmail">Email</label>
                                <div class="input-group">
                                    <input type="email" class="form-control" name="contactEmail" id="contactEmail" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="contactPostalAddress">Postal Address</label>
                                <div class="input-group">
                                    <input class="form-control" name="contactPostalAddress" id="contactPostalAddress" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group has-feedback">
                                <label for="preferredFormat">Preferred format</label>
                                <div class="input-group">
                                    <select class="form-control" name="contactPreferredFormat" id="contactPreferredFormat" required></select>
                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="save-contact-btn" type="submit" class="btn btn-primary">Save</button>
                </div>
                </form>
            </div>
        </form>
        </div>
    </div> 
    <div class="modal fade" id="delete-contact-modal" tabindex="-1" role="dialog" >
        <div class="modal-dialog">
            <div class="modal-content">

                <form id="delete-contact-form" role="form" name="modalForm" action="#" >

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> <span>x</span><span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title">Confirmation needed</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="id-to-be-removed" value="" />
                    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>This contact will be permanently deleted. Are you sure?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="delete-contact-btn" type="button" class="btn btn-primary">Do it!</button>
                </div>

                </form>
            </div>
        </div>
    </div>    
</body>

</html>
    